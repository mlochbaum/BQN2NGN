#!/usr/bin/env apl

Queensâ†{                            â The N-queens problem.

    Searchâ†{                        â Search for all solutions.
        (<â¬)âˆŠğ•©:0â¥Š<â¬                 â stitched: abandon this branch.
        0=â‰ ğ•©:Rmdups ğ•¨               â all done: solution!
        hdâ€¿tlâ†âŸ¨âŠ‘ğ•©â‹„1â†“ğ•©âŸ©              â head 'n tail of remaining ranks.
        nextâ†ğ•¨âŠ¸âˆ¾Â¨hd                 â possible next steps.
        remsâ†hd FreeÂ¨<tl            â unchecked squares.
        âˆ¾next âˆ‡Â¨rems                â ... in following ranks.
    }

    cvexâ†(1+â†•ğ•©)Ã—<Â¯1â€¿0â€¿1             â Checking vectors.

    Freeâ†{ğ•©(Â¬âˆ˜âˆŠ/âŠ£)Â¨ğ•¨+ğ•©â‰¢âŠ¸â†‘cvex}      â Unchecked squares.

    Rmdupsâ†{                        â Ignore duplicate solution.
        Rotsâ†(â†•4){â’âŸğ•¨ ğ•©}Â¨<          â 4 rotations.
        Refsâ†(â†•2){â‹âŸğ•¨ ğ•©}Â¨<          â 2 reflections.
        Bestâ†(âŠ‘â‹)âŠ¸âŠ‘                 â best (=lowest) solution.
        all8â†â¥Š>RefsÂ¨Rots ğ•©          â all 8 orientations.
        (ğ•©â‰¡Best all8)âŠ‘âŸ¨â¬â‹„â¥Š<ğ•©âŸ©       â ignore if not best.
    }

    Fmtâ†{                           â Format solution.
        charsâ†"Â·âŸ"âŠËœ(>ğ•©)=âŒœâ†•ğ•¨        â char array of placed queens.
        expdâ†1â†“âˆ¾ğ•¨â¥Š<0â€¿1              â expansion mask.
        <â‰2 expd /â¼â‰1 chars         â vector of char matrices.
    }

    squaresâ†(<â†•âŒˆğ•©Ã·2)âˆ¾1â†“ğ•©â¥Š<â†•ğ•©        â initial squares

    ğ•© Fmt â¬ Search squares          â all distinct solutions.
}

â€¢â†Queens 5
